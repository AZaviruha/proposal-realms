{"version":3,"file":null,"sources":["../src/sandbox.js","../src/sanitize.js","../src/evaluator.js","../src/stdlib.js","../src/intrinsics.js","../src/main.js"],"sourcesContent":["let windshieldCache;\n\nfunction createIframe() {\n    const el = document.createElement(\"iframe\");\n    el.style.display = \"none\";\n    // accessibility\n    el.title = \"script\";\n    el.setAttribute('aria-hidden', true);\n    document.body.appendChild(el);\n    return el;\n}\n\nfunction getWindshield(iframe) {\n    if (windshieldCache) {\n        return windshieldCache;\n    }\n    const { contentWindow: confinedWindow } = iframe;\n    const windshieldCache = confinedWindow.Object.create(null);\n    /**\n     * This is a one time operation to create this giant object with a bunch of properties\n     * set to `undefined` to shadow every global binding in iframes' `window`.\n     * This object will be used as the base lexical scope when evaluating source text\n     * inside any realm. It can be reused because it has no authority, and it should always\n     * be the same since the window object of a brand new iframe is always the same as well.\n     */\n    Object.getOwnPropertyNames(confinedWindow).forEach(function (name) {\n        // TODO: recursive to cover WindowPrototype properties as well\n        Object.defineProperty(windshieldCache, name, {\n            value: undefined,\n            enumerable: false,\n            configurable: false,\n            writable: false,\n        });\n    });\n    Object.freeze(windshieldCache);\n    return windshieldCache;\n}\n\nexport function createSandbox() {\n    const iframe = createIframe();\n    const { contentDocument: iframeDocument, contentWindow: confinedWindow } = iframe;\n    const windshield = getWindshield(iframe);\n    return {\n        windshield,\n        iframe,\n        iframeDocument,\n        confinedWindow,\n    };\n}","// locking down the environment\nexport function sanitize(sandbox) {\n    const { confinedWindow: { Object, parent: { Object: parentObject } } } = sandbox;\n    try {\n        // Fixing properties of Object to comply with strict mode\n        // and ES2016 semantics, we do this by redefining them while in 'use strict'\n        // https://tc39.github.io/ecma262/#sec-object.prototype.__defineGetter__\n        [Object, parentObject].forEach(function (o) {\n            if (o === undefined) {\n                return;\n            }\n            o.defineProperty(o.prototype, '__defineGetter__', {\n                value: function (key, fn) {\n                    return o.defineProperty(this, key, {\n                        get: fn\n                    });\n                }\n            });\n            o.defineProperty(o.prototype, '__defineSetter__', {\n                value: function (key, fn) {\n                    return o.defineProperty(this, key, {\n                        set: fn\n                    });\n                }\n            });\n            o.defineProperty(o.prototype, '__lookupGetter__', {\n                value: function (key) {\n                    var d, p = this;\n                    while (p && (d = o.getOwnPropertyDescriptor(p, key)) === undefined) {\n                        p = o.getPrototypeOf(this);\n                    }\n                    return d ? d.get : undefined;\n                }\n            });\n            o.defineProperty(o.prototype, '__lookupSetter__', {\n                value: function (key) {\n                    var d, p = this;\n                    while (p && (d = o.getOwnPropertyDescriptor(p, key)) === undefined) {\n                        p = o.getPrototypeOf(this);\n                    }\n                    return d ? d.set : undefined;\n                }\n            });\n            // Immutable Prototype Exotic Objects\n            // https://github.com/tc39/ecma262/issues/272\n            o.seal(o.prototype);\n        });\n    } catch (ignore) {\n        // Ignored\n    }\n}","\nconst HookFnName = '$RealmEvaluatorIIFE$';\n\n// TODO: we really need to find a way to do the right thing here.\n// wrapping the source with `with` statements create a new lexical scope,\n// that can prevent access to the globals in the sandbox by shadowing them\n// with the properties of the windshield.\n// additionally, strict mode is enforced to prevent leaking\n// global variables into the sandbox.\nfunction addLexicalScopesToSource(sourceText) {\n    /**\n     * We use two `with` statements, the outer one uses `argments[1]`, which is the\n     * `sandbox.windshield`, while the inner `with` statement uses `argument[0]`,\n     * which is the realm's global object. Aside from that, the `this` value in\n     * sourceText will correspond to `argument[0]` as well.\n     */\n    return `\n        function ${HookFnName}() {\n            with (arguments[1]) {\n                with(arguments[0]) {\n                    return (function(){\n                        \"use strict\";\n                        return eval(\\`${sourceText}\\`);\n                    }).call(arguments[0]);\n                }\n            }\n        }\n    `;\n}\n\nfunction evalAndReturn(sourceText, sandbox) {\n    const { iframeDocument, confinedWindow } = sandbox;\n    const { body: iframeBody } = iframeDocument;\n    const script = iframeDocument.createElement('script');\n    script.type = 'text/javascript';\n    confinedWindow[HookFnName] = undefined;\n    script.appendChild(iframeDocument.createTextNode(sourceText));\n    iframeBody.appendChild(script);\n    iframeBody.removeChild(script);\n    const result = confinedWindow[HookFnName];\n    confinedWindow[HookFnName] = undefined;\n    return result;\n}\n\nexport function evaluate(sourceText, realm, sandbox) {\n    if (!sourceText) {\n        return undefined;\n    }\n    sourceText = addLexicalScopesToSource(sourceText);\n    const fn = evalAndReturn(sourceText, sandbox);\n    return fn.apply(undefined, [realm.global, sandbox.windshield]);\n}","export function getStdLib(sandbox) {\n    const { confinedWindow: _ } = sandbox;\n    return {\n        Array: { value: _.Array },\n        ArrayBuffer: { value: _.ArrayBuffer },\n        Boolean: { value: _.Boolean },\n        DataView: { value: _.DataView },\n        Date: { value: _.Date },\n        decodeURI: { value: _.decodeURI },\n        decodeURIComponent: { value: _.decodeURIComponent },\n        encodeURI: { value: _.encodeURI },\n        encodeURIComponent: { value: _.encodeURIComponent },\n        Error: { value: _.Error },\n        eval: { value: _.eval },\n        EvalError: { value: _.EvalError },\n        Float32Array: { value: _.Float32Array },\n        Float64Array: { value: _.Float64Array },\n        Function: { value: _.Function },\n        Int8Array: { value: _.Int8Array },\n        Int16Array: { value: _.Int16Array },\n        Int32Array: { value: _.Int32Array },\n        isFinite: { value: _.isFinite },\n        isNaN: { value: _.isNaN },\n        JSON: { value: _.JSON },\n        Map: { value: _.Map },\n        Math: { value: _.Math },\n        Number: { value: _.Number },\n        Object: { value: _.Object },\n        parseFloat: { value: _.parseFloat },\n        parseInt: { value: _.parseInt },\n        Promise: { value: _.Promise },\n        Proxy: { value: _.Proxy },\n        RangeError: { value: _.RangeError },\n        ReferenceError: { value: _.ReferenceError },\n        Reflect: { value: _.Reflect },\n        RegExp: { value: _.RegExp },\n        Set: { value: _.Set },\n        String: { value: _.String },\n        Symbol: { value: _.Symbol },\n        SyntaxError: { value: _.SyntaxError },\n        TypeError: { value: _.TypeError },\n        Uint8Array: { value: _.Uint8Array },\n        Uint8ClampedArray: { value: _.Uint8ClampedArray },\n        Uint16Array: { value: _.Uint16Array },\n        Uint32Array: { value: _.Uint32Array },\n        URIError: { value: _.URIError },\n        WeakMap: { value: _.WeakMap },\n        WeakSet: { value: _.WeakSet },\n        \n        // TODO: Annex B\n        // TODO: other special cases\n    };\n}","export function getIntrinsics(sandbox) {\n    const { confinedWindow: _ } = sandbox;\n    return {\n        // %Array%\n        \"Array\": _.Array,\n        // %ArrayBuffer%\n        \"ArrayBuffer\": _.ArrayBuffer,\n        // %ArrayBufferPrototype%\n        \"ArrayBufferPrototype\": _.ArrayBuffer.prototype,\n        // %ArrayIteratorPrototype%\n        \"ArrayIteratorPrototype\": undefined,\n        // %ArrayPrototype%\n        \"ArrayPrototype\": _.Array.prototype,\n        // %ArrayProto_values%\n        \"ArrayProto_values\": _.Array.prototype.values,\n        // %Boolean%\n        \"Boolean\": _.Boolean,\n        // %BooleanPrototype%\n        \"BooleanPrototype\": _.Boolean.prototype,\n        // %DataView%\n        \"DataView\": _.DataView,\n        // %DataViewPrototype%\n        \"DataViewPrototype\": _.DataView.prototype,\n        // %Date%\n        \"Date\": _.Date,\n        // %DatePrototype%\n        \"DatePrototype\": _.Date.prototype,\n        // %decodeURI%\n        \"decodeURI\": _.decodeURI,\n        // %decodeURIComponent%\n        \"decodeURIComponent\": _.decodeURIComponent,\n        // %encodeURI%\n        \"encodeURI\": _.encodeURI,\n        // %encodeURIComponent%\n        \"encodeURIComponent\": _.encodeURIComponent,\n        // %Error%\n        \"Error\": _.Error,\n        // %ErrorPrototype%\n        \"ErrorPrototype\": _.Error.prototype,\n        // %eval%\n        \"eval\": _.eval,\n        // %EvalError%\n        \"EvalError\": _.EvalError,\n        // %EvalErrorPrototype% \n        \"EvalErrorPrototype\": _.EvalError.prototype,\n        // %Float32Array%\n        \"Float32Array\": _.Float32Array,\n        // %Float32ArrayPrototype%\n        \"Float32ArrayPrototype\": _.Float32Array.prototype,\n        // %Float64Array%\n        \"Float64Array\": _.Float64Array,\n        // %Float64ArrayPrototype%\n        \"Float64ArrayPrototype\": _.Float64Array.prototype,\n        // %Function%\n        \"Function\": _.Function,\n        // %FunctionPrototype%\n        \"FunctionPrototype\": _.Function.prototype,\n        // %Generator%\n        \"Generator\": undefined,\n        // %GeneratorFunction%\n        \"GeneratorFunction\": undefined,\n        // %GeneratorPrototype%\n        \"GeneratorPrototype\": undefined,\n        // %Int8Array%\n        \"Int8Array\": _.Int8Array,\n        // %Int8ArrayPrototype%\n        \"Int8ArrayPrototype\": _.Int8Array.prototype,\n        // %Int16Array%\n        \"Int16Array\": _.Int16Array,\n        // %Int16ArrayPrototype%,\n        \"Int16ArrayPrototype\": _.Int16Array.prototype,\n        // %Int32Array%\n        \"Int32Array\": _.Int32Array,\n        // %Int32ArrayPrototype%\n        \"Int32ArrayPrototype\": _.Int32Array.prototype,\n        // %isFinite%\n        \"isFinite\": _.isFinite,\n        // %isNaN%\n        \"isNaN\": _.isNaN,\n        // %IteratorPrototype%\n        \"IteratorPrototype\": undefined,\n        // %JSON%\n        \"JSON\": _.JSON,\n        // %Map%\n        \"Map\": _.Map,\n        // %MapIteratorPrototype%\n        \"MapIteratorPrototype\": undefined,\n        // %MapPrototype%\n        \"MapPrototype\": _.Map.prototype,\n        // %Math%\n        \"Math\": _.Math,\n        // %Number%\n        \"Number\": _.Number,\n        // %NumberPrototype%\n        \"NumberPrototype\": _.Number.prototype,\n        // %Object%\n        \"Object\": _.Object,\n        // %ObjectPrototype%\n        \"ObjectPrototype\": _.Object.prototype,\n        // %ObjProto_toString%\n        \"ObjProto_toString\": _.Object.prototype.toString,\n        // %ObjProto_valueOf%\n        \"ObjProto_valueOf\": _.Object.prototype.valueOf,\n        // %parseFloat%\n        \"parseFloat\": _.parseFloat,\n        // %parseInt%\n        \"parseInt\": _.parseInt,\n        // %Promise%\n        \"Promise\": _.Promise,\n        // %PromisePrototype%\n        \"PromisePrototype\": _.Promise.prototype,\n        // %Proxy%\n        \"Proxy\": _.Proxy,\n        // %RangeError%\n        \"RangeError\": _.RangeError,\n        // %RangeErrorPrototype%\n        \"RangeErrorPrototype\": _.RangeError.prototype,\n        // %ReferenceError%\n        \"ReferenceError\": _.ReferenceError,\n        // %ReferenceErrorPrototype%\n        \"ReferenceErrorPrototype\": _.ReferenceError.prototype,\n        // %Reflect%\n        \"Reflect\": _.Reflect,\n        // %RegExp%\n        \"RegExp\": _.RegExp,\n        // %RegExpPrototype%\n        \"RegExpPrototype\": _.RegExp.prototype,\n        // %Set%\n        \"Set\": _.Set,\n        // %SetIteratorPrototype%\n        \"SetIteratorPrototype\": undefined,\n        // %SetPrototype%\n        \"SetPrototype\": _.Set.prototype,\n        // %String%\n        \"String\": _.String,\n        // %StringIteratorPrototype%\n        \"StringIteratorPrototype\": undefined,\n        // %StringPrototype%\n        \"StringPrototype\": _.String.prototype,\n        // %Symbol%\n        \"Symbol\": _.Symbol,\n        // %SymbolPrototype%\n        \"SymbolPrototype\": _.Symbol.prototype,\n        // %SyntaxError%\n        \"SyntaxError\": _.SyntaxError,\n        // %SyntaxErrorPrototype%\n        \"SyntaxErrorPrototype\": _.SyntaxError.prototype,\n        // %ThrowTypeError%\n        \"ThrowTypeError\": undefined,\n        // %TypedArray%\n        \"TypedArray\": undefined,\n        // %TypedArrayPrototype%\n        \"TypedArrayPrototype\": undefined,\n        // %TypeError%\n        \"TypeError\": _.TypeError,\n        // %TypeErrorPrototype%\n        \"TypeErrorPrototype\": _.TypeError.prototype,\n        // %Uint8Array%\n        \"Uint8Array\": _.Uint8Array,\n        // %Uint8ArrayPrototype%\n        \"Uint8ArrayPrototype\": _.Uint8Array.prototype,\n        // %Uint8ClampedArray%\n        \"Uint8ClampedArray\": _.Uint8ClampedArray,\n        // %Uint8ClampedArrayPrototype%\n        \"Uint8ClampedArrayPrototype\": _.Uint8ClampedArray.prototype,\n        // %Uint16Array%\n        \"Uint16Array\": _.Uint16Array,\n        // %Uint16ArrayPrototype%\n        \"Uint16ArrayPrototype\": Uint16Array.prototype,\n        // %Uint32Array%\n        \"Uint32Array\": _.Uint32Array,\n        // %Uint32ArrayPrototype%\n        \"Uint32ArrayPrototype\": _.Uint32Array.prototype,\n        // %URIError%\n        \"URIError\": _.URIError,\n        // %URIErrorPrototype%\n        \"URIErrorPrototype\": _.URIError.prototype,\n        // %WeakMap%\n        \"WeakMap\": _.WeakMap,\n        // %WeakMapPrototype%\n        \"WeakMapPrototype\": _.WeakMap.prototype,\n        // %WeakSet%\n        \"WeakSet\": _.WeakSet,\n        // %WeakSetPrototype%\n        \"WeakSetPrototype\": _.WeakSet.prototype,\n        \n        // TODO: Annex B\n        // TODO: other special cases\n    };\n}","import { createSandbox } from \"./sandbox.js\";\nimport { sanitize } from \"./sanitize.js\";\nimport { evaluate } from \"./evaluator.js\";\nimport { getStdLib } from \"./stdlib.js\";\nimport { getIntrinsics } from \"./intrinsics.js\";\n\nconst RealmToSandbox = new WeakMap();\n\nfunction getSandbox(realm) {\n    const sandbox = RealmToSandbox.get(realm);\n    if (!sandbox) {\n        throw new Error(`Invalid realm object.`);\n    }\n    return sandbox;\n}\n\nexport default class Realm {\n\n    constructor() {\n        const sandbox = createSandbox();\n        sanitize(sandbox);\n        // TODO: assert that RealmToSandbox does not have `this` entry\n        RealmToSandbox.set(this, sandbox);\n        const { confinedWindow } = sandbox;\n        this.global = confinedWindow.Object.create(null);\n        this.init();\n    }\n\n    init() {\n        Object.defineProperties(this.global, this.stdlib);\n    }\n\n    eval(sourceText) {\n        const sandbox = getSandbox(this);\n        return evaluate(sourceText, this, sandbox);\n    }\n\n    get stdlib() {\n        const sandbox = getSandbox(this);\n        return getStdLib(sandbox);\n    }\n\n    get intrinsics() {\n        const sandbox = getSandbox(this);\n        return getIntrinsics(sandbox);\n    }\n\n}"],"names":["createIframe","el","document","createElement","style","display","title","setAttribute","body","appendChild","getWindshield","iframe","windshieldCache","confinedWindow","contentWindow","Object","create","getOwnPropertyNames","forEach","name","defineProperty","undefined","freeze","createSandbox","iframeDocument","contentDocument","windshield","sanitize","sandbox","parentObject","parent","o","prototype","key","fn","d","p","getOwnPropertyDescriptor","getPrototypeOf","get","set","seal","ignore","HookFnName","addLexicalScopesToSource","sourceText","evalAndReturn","iframeBody","script","type","createTextNode","removeChild","result","evaluate","realm","apply","global","getStdLib","_","value","Array","ArrayBuffer","Boolean","DataView","Date","decodeURI","decodeURIComponent","encodeURI","encodeURIComponent","Error","eval","EvalError","Float32Array","Float64Array","Function","Int8Array","Int16Array","Int32Array","isFinite","isNaN","JSON","Map","Math","Number","parseFloat","parseInt","Promise","Proxy","RangeError","ReferenceError","Reflect","RegExp","Set","String","Symbol","SyntaxError","TypeError","Uint8Array","Uint8ClampedArray","Uint16Array","Uint32Array","URIError","WeakMap","WeakSet","getIntrinsics","values","toString","valueOf","RealmToSandbox","getSandbox","Realm","init","defineProperties","stdlib"],"mappings":"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"}